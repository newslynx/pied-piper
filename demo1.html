<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>Create a zip file demo</title>
<link rel="stylesheet" href="demo.css">
</head>

<body>
	<div id="container">

		<div class="description">
			A JavaScript library to zip and unzip files
			<hr>
		</div>
		
		<h2>Create a zip file demo</h2>
		
		<ol id="demo-container">
			<li>
				<span class="form-label">download the zip file</span>
				<a id="download-button" href="#">Download</a>
			</li>
		</ol>

	</div>
	<script type="text/javascript" src="zip.js"></script>
	<script>

		// Cache some functions cross-browserly
		var WINDOW = window,
				URL = WINDOW.webkitURL || WINDOW.mozURL || WINDOW.URL,
				createObjectURL = URL.createObjectURL; // Convert a compressed blob object to a data URL

	  var json_data = [
	  	{name: 'michael'},
	  	{name: 'henry'}
	  ];

		// creates a zip storing the file "lorem.txt" with blob as data
		// the zip will be stored into a Blob object (zippedBlob)
		zipMultiple(json_data, function(zippedBlob) {
			var zipped_blog_href = createObjectURL(zippedBlob);
			var DOM_download_btn = document.getElementById('download-button');
			DOM_download_btn.href = zipped_blog_href;
			DOM_download_btn.download = 'newslynx-data.zip';
		});

		function zipMultiple(files, cb) {
			var addIndex = 0,
					writer = new zip.BlobWriter("application/zip"),
					zipWriter;

			function nextFile() {
				var file = files[addIndex],
				 		blob = new Blob([ JSON.stringify(file) ], { type : "text/plain" }),
						blob_reader = new zip.BlobReader(blob);

				zipWriter.add(addIndex.toString()+'-file.txt', blob_reader, function(){
					addIndex++;
					if (addIndex < files.length) {
						nextFile();
					} else {
						zipWriter.close(cb);
					}
				});
			}

			zip.createWriter(writer, function(writer) {
				zipWriter = writer;
				nextFile();
			}, reportError);

		}

		// function unzipBlob(blob, callback) {
		//   // use a zip.BlobReader object to read zipped data stored into blob variable
		//   zip.createReader(new zip.BlobReader(blob), function(zipReader) {
		//     // get entries from the zip file
		//     zipReader.getEntries(function(entries) {
		//       // get data from the first file
		//       entries[0].getData(new zip.BlobWriter("text/plain"), function(data) {
		//         // close the reader and calls callback function with uncompressed data as parameter
		//         zipReader.close();
		//         callback(data);
		//       });
		//     });
		//   }, reportError);
		// }

		function reportError(message) {
		  console.error(message);
		}
	</script>
</body>
</html>